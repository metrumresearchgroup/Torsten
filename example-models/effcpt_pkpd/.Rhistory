q()
q()
library("cmdstanr")
files <- dir("output.[1-4].csv", full.names=TRUE))
files <- dir("output.[1-4].csv", full.names=TRUE)
files
files <- dir(patter="output.[1-4].csv", full.names=TRUE)
files

fit.seq$summary()
as_cmdstan_fit(dir(patter="output.[1-3].csv", full.names=TRUE))$summary()
library("dplyr")
library("dplyr")
summary.seq <- fit.seq$summary()
summary.seq %>% add_column(warmup_time=7881, sampling_time=8230)
library("tibble")
summary.seq %>% add_column(warmup_time=7881, sampling_time=8230)
options(tibble.width = Inf)
summary.seq %>% add_column(warmup_time=7881, sampling_time=8230)
summary.seq %>% add_column(warmup_time=7881, sampling_time=8230, method=standard)
summary.seq %>% add_column(warmup_time=7881, sampling_time=8230, method="standard")
summary.seq %>% add_column(warmup_time=7881, sampling_time=8230, method="standard", target_ESS=NA)
summary.seq %>% add_column(warmup_time=7881, sampling_time=8230, method="standard", target_ESS=NA, parallel_chains=4)
seq <- summary.seq %>% add_column(warmup_time=7881, sampling_time=8230, method="standard", target_ESS=NA, parallel_chains=4)
fit.n4.ess200 <- as_cmdstan_fit(dir(patter="output_cc_n4_ess200.mpi.[0-3].csv", full.names=TRUE))
ls()
n4.ess200 <- fit.n4.ess200$summary()
n4.ess200 <- n4.ess200 %>% add_column(warmup_time=3600, sampling_time=8685, method="cross-chain", target_ESS=200, parallel_chains=4)
n4.ess200
fit <- as_cmdstan_fit(dir(patter="output_cc_n4_ess400.mpi.[0-3].csv", full.names=TRUE))
n4.ess400 <- fit$summary()
n4.ess400
n4.ess400 <- n4.ess400 %>% add_column(warmup_time=6134, sampling_time=8016, method="cross-chain", target_ESS=400, parallel_chains=4)
n4.ess400
fit <- as_cmdstan_fit(dir(patter="output_cc_n4_ess600.mpi.[0-3].csv", full.names=TRUE))
n4.ess600 <- fit$summary()
n4.ess600 <- n4.ess600 %>% add_column(warmup_time=7591, sampling_time=7454, method="cross-chain", target_ESS=600, parallel_chains=4)
get.summary <- function(files, warmup_t, sampling_t, ess, nchain) {fit <- as_cmdstan_fit(files); return fit$summary() %>% add_column(warmup_time=warmup_t, sampling_time=sampling_t, method="cross-chain", target_ESS=ess, parallel_chains=nchain)}
get.summary <- function(files, warmup_t, sampling_t, ess, nchain) {
fit <- as_cmdstan_fit(files)
return fit$summary() %>% add_column(warmup_time=warmup_t, sampling_time=sampling_t, method="cross-chain", target_ESS=ess, parallel_chains=nchain)}
get.summary <- function(files, warmup_t, sampling_t, ess, nchain) {
fit <- as_cmdstan_fit(files)
s <- fit$summary()
s %>% add_column(warmup_time=warmup_t, sampling_time=sampling_t, method="cross-chain", target_ESS=ess, parallel_chains=nchain)
return s}
get.summary <- function(files, warmup_t, sampling_t, ess, nchain) {
fit <- as_cmdstan_fit(files)
s <- fit$summary()
add_column(s, warmup_time=warmup_t, sampling_time=sampling_t, method="cross-chain", target_ESS=ess, parallel_chains=nchain)
return s}
get.summary <- function(files, warmup_t, sampling_t, ess, nchain) {
fit <- as_cmdstan_fit(files)
s <- fit$summary()
tibble::add_column(s, warmup_time=warmup_t, sampling_time=sampling_t, method="cross-chain", target_ESS=ess, parallel_chains=nchain)
return s}
get.summary <- function(files, t1, t2, ess, nchain) {
    fit <- as_cmdstan_fit(files)
    s <- fit$summary()
    tibble::add_column(s, warmup_time=t1, sampling_time=t2, method="cross-chain", target_ESS=ess, parallel_chains=nchain)
    return(s)}
get.summary
files <-  dir(patter="output_cc_n8_ess200.mpi.[0-7].csv", full.names=TRUE)
n8.ess200 <- get.summary(files, 4328, 9808, 200, 8)
n8.ess200
get.summary <- function(files, t1, t2, ess, nchain) {
    fit <- as_cmdstan_fit(files)
    s <- fit$summary()
    s  <- tibble::add_column(s, warmup_time=t1, sampling_time=t2, method="cross-chain", target_ESS=ess, parallel_chains=nchain)
    return(s)}
n8.ess200 <- get.summary(files, 4328, 9808, 200, 8)
n8.ess200
n8.ess400 <- get.summary(files, 5197, 9235, 400, 8)
files <-  dir(patter="output_cc_n8_ess400.mpi.[0-7].csv", full.names=TRUE)
files
n8.ess400 <- get.summary(files, 5197, 9235, 400, 8)
n8.ess400
files <-  dir(patter="output_cc_n8_ess600.mpi.[0-7].csv", full.names=TRUE)
n8.ess600 <- get.summary(files, 5622, 9678, 600, 8)
n8.ess600
ls()
files <-  dir(patter="output_cc_n16_ess200.mpi*.csv", full.names=TRUE)
files
files <-  dir(patter="output_cc_n16_ess200*.csv", full.names=TRUE)
files
files <-  dir(patter="output_cc_n16_ess200.*.csv", full.names=TRUE)
files
n16.ess200 <- get.summary(files, 3286, 10313, 200, 16)
n16.ess200
files <-  dir(patter="output_cc_n16_ess400.*.csv", full.names=TRUE)
n16.ess400 <- get.summary(files, 4407, 11012, 400, 16)
n16.ess400
files <-  dir(patter="output_cc_n16_ess600.*.csv", full.names=TRUE)
files
n16.ess600 <- get.summary(files, 4401, 11006, 600, 16)
n16.ess600
save.image()
ls()
ls()
n16.ess200
n32.ess200 <- readr::read_csv(file="n32_ess200.csv")
n32.ess200
n32.ess200 <- readr::read_delim(file="n32_ess200.csv")
n32.ess200 <- readr::read_csv(file="n32_ess200.csv")
n32.ess200
n32.ess400
n32.ess400 <- readr::read_csv(file="n32_ess400.csv")
n32.ess600 <- readr::read_csv(file="n32_ess600.csv")
n32.ess600
ls()
summary <- seq
bind_row(summary, n4.ess200)
bind_rows(summary, n4.ess200)
seq
bind_rows(summary, n4.ess200)
grep("c*", ls())
grep("n*", ls())
grep("n.*", ls())
grep("n[1-9]*.*", ls())
ls()[grep("n[1-9]*.*", ls())]
summary <- bind_rows(seq, n4.ess200, n4.ess400, n4.ess600, n8.ess200, n8.ess400, n8.ess600, n16.ess200, n16.ess400, n16.ess600, n32.ess200, n32.ess400, n32.ess600)
library("ggplot2")
summary
debug <- seq
debug %>% add_column(ess_bulk/s=ess_bulk/sampling_time)
debug %>% add_column(ess_bulk_per_sec=ess_bulk/sampling_time)
debug %>% mutate(ess_bulk_per_sec=ess_bulk/sampling_time)
debug %>% mutate(ess_bulk_per_sec=ess_bulk/sampling_time, ess_bulk_per_sec_per_chain=ess_bulk/sampling_time/parallel_chains)
ls()
rm(debug)
ls()
rm(fit)
ls()
rm(fit.n4.ess200)
rm(fit.seq)
ls()
rm(files)
ls()
save.image()
savehistory()
q()
ls()
library("dplyr")
library("tidyverse")
loadhistory()
ls()
lp.summary
options(tibble.width=19)
lp.summary
options(tibble.width=Inf)
lp.summary
ggplot(lp.summary, aes(fill=parallel_chains, x=target_ESS, y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")
lp.summary[1, "target_ESS"]=0
lp.summary
ggplot(lp.summary, aes(fill=parallel_chains, x=target_ESS, y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")
ggplot(lp.summary, aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")
lp.summary %>% select(method="cross-chain")
lp.summary %>% select(method:"cross-chain")
lp.summary %>% filter(method="cross-chain")
lp.summary %>% filter(method=="cross-chain")
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[1,ess_tail_per_sec_per_chain])
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[1,"ess_tail_per_sec_per_chain"])
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[[ess_tail_per_sec_per_chain]])
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[[ess_tail_per_sec_per_chain]])
lp.summary[[ess_tail_per_sec_per_chain]]
lp.summary[["ess_tail_per_sec_per_chain"]]
lp.summary[1, "ess_tail_per_sec_per_chain"]
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[1, "ess_tail_per_sec_per_chain"])
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1])
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],colour = "grey")
ggplot(lp.summary %>% filter(method=="cross-chain"), aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain))+geom_bar(position="dodge", stat="identity")+geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed")
source("plot.R")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)")

ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)",color="number of chains\n")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)",color="number of chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)", color="number of parallel chains")

ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)", col="number of parallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)", col="chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y =
       "ESS_tail/(sampling time * number of chains)") + scale_fill_discrete(name="Experimental\nCondition")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)") +
    scale_fill_discrete(name="Number of parallel chains")

ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_tail/(sampling time * number of chains)") +
    scale_fill_discrete(name="Number of \nparallel chains")
ggsave(filename="ess_tail_per_time_chain.pdf",width=6, height=4)
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_bulk_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_bulk_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = "ESS_bulk/(sampling time * number of chains)") +
    scale_fill_discrete(name="Number of \nparallel chains")
ggsave(filename="ess_bulk_per_time_chain.pdf",width=6, height=4)
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(sampling_time  number of chains)")) +
    scale_fill_discrete(name="Number of \nparallel chains")
library(latex2exp)
install.packages(latex2exp)
install.packages("latex2exp")
library("latex2exp")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(sampling_time  number of chains)")) +
    scale_fill_discrete(name="Number of \nparallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(Time_{sampling} \times n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(Time_{sampling} \\times n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(Time_{sampling} \\\times n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(Time_{sampling} (\\times) n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(Time_{sampling} {\\times} n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(Time_{sampling} X n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_tail/(Time_{sampling} x n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")

ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})")) +
    scale_fill_discrete(name="Number of \nparallel chains")

ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_tail_per_sec_per_chain)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})")) +
    scale_fill_discrete(name=TeX("n_{chains}"))
source("plot.R")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_bulk_per_sec)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_bulk_per_sec"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_{bulk}/(Time_{sampling})")) +
    scale_fill_discrete(name=TeX("n_{chains}"))
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(fill=as.factor(parallel_chains), x=as.factor(target_ESS), y=ess_bulk_per_sec)) +
    geom_bar(position="dodge", stat="identity") +
    geom_hline(yintercept=lp.summary[["ess_bulk_per_sec"]][1],linetype = "dashed") +
    labs(x = "Target ESS", y = TeX("ESS_{bulk}/Time_{sampling}")) +
    scale_fill_discrete(name=TeX("n_{chains}"))
ggsave(filename="ess_bulk_per_time.pdf",width=6, height=4)
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_tail_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})")) +
    scale_fill_discrete(name="Target ESS")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_tail_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})")) +
    scale_fill_discrete(name="Target ESS")+scale_y_continuous(trans='log2')
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_tail_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})")) +
    scale_fill_discrete(name="Target ESS")+scale_x_continuous(trans='log2')
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_tail_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})")) +
    scale_group_discrete(name="Target ESS")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_tail_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})"), linetype="fdaf") 
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_tail_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_tail_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{tail}/(Time_{sampling} x n_{chains})"), shape="fdaf",linetype="fdaf")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_bulk_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_bulk_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{bulk}/(Time_{sampling} x n_{chains})"), shape="fdaf",linetype="fdaf")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_bulk_per_sec_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_bulk_per_sec_per_chain"]][1],linetype = "dashed") +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{bulk}/(Time_{sampling} x n_{chains})"), shape="Target ESS",linetype="Target ESS")
source("plot.R")
ggplot(lp.summary %>% filter(method=="cross-chain"),
       aes(group=as.factor(target_ESS), x=parallel_chains, y=ess_bulk_per_sec)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_bulk_per_sec"]][1],linetype = "dashed") +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chains}"), y = TeX("ESS_{bulk}/Time_{sampling}"), shape="Target ESS",linetype="Target ESS")
source("plot.R")
source("plot.R")
source("plot.R")
ls()
write.table(extended.summary, file = "summary.csv")
write.table(extended.summary, file = "summary.csv", sep=",")
lp.summary
lp.summary  <- lp.summary %>% mutate(total_time=warmup_time+sampling_time)
lp.summary
lp.summary  <- lp.summary %>% mutate(ess_bulk_per_total_time_per_chain=ess_bulk/parallel_chains/total_time)
lp.summary
lp.summary  <- lp.summary %>% mutate(ess_tail_per_total_time_per_chain=ess_tail/parallel_chains/total_time)
lp.summary
ggplot(lp.summary %>% filter(method=="cross-chain"),
        aes(group=as.factor(target_ESS), color=as.factor(target_ESS), x=parallel_chains, y=ess_bulk_per_total_time_per_chain)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    geom_hline(yintercept=lp.summary[["ess_bulk_per_total_time_per_chain"]][1],linetype = "dashed") +
    scale_x_continuous(trans='log2') +
    labs(x = TeX("n_{chain}"), y = TeX("ESS_{bulk}/(Time_{total} x n_{chain})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
source("plot.R")
lp.summary  <- lp.summary %>% mutate(ess_tail_per_total_time=ess_tail/total_time)
lp.summary  <- lp.summary %>% mutate(ess_bulk_per_total_time=ess_bulk/total_time)
lp.summary
lp.summary %>% select(target_ESS=200)
lp.summary %>% select(target_ESS="200")
lp.summary %>% filter(target_ESS==200)
lp.summary %>% filter(target_ESS==200) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/0.0710)
lp.summary
lp.summary %>% filter(target_ESS==200) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/0.0710)
lp.summary %>% filter(target_ESS==200) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/ess_bulk_per_total_time[1])
lp.efficiency.200 <- lp.summary %>% filter(target_ESS==200) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/ess_bulk_per_total_time[1])
lp.efficiency.400 <- lp.summary %>% filter(target_ESS==400) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/ess_bulk_per_total_time[1])
lp.efficiency.600 <- lp.summary %>% filter(target_ESS==600) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/ess_bulk_per_total_time[1])
lp.efficiency.200
lp.efficiency.400
lp.efficiency.600
lp.bulk.efficiency  <- bind_rows(lp.efficiency.200, lp.efficiency.400, lp.efficiency.600)
lp.bulk.efficiency
lp.efficiency.200 <- lp.summary %>% filter(target_ESS==200) %>% mutate(ess_tail_efficiency=ess_tail_per_total_time/ess_tail_per_total_time[1])
lp.efficiency.400 <- lp.summary %>% filter(target_ESS==400) %>% mutate(ess_tail_efficiency=ess_tail_per_total_time/ess_tail_per_total_time[1])
lp.efficiency.600 <- lp.summary %>% filter(target_ESS==600) %>% mutate(ess_tail_efficiency=ess_tail_per_total_time/ess_tail_per_total_time[1])
lp.tail.efficiency  <- bind_rows(lp.efficiency.200, lp.efficiency.400, lp.efficiency.600)
lp.tail.efficiency
lp.efficiency <- lp.bulk.efficiency %>% add_column(lp.bulk.efficiency[[ess_tail_efficiency]])
lp.efficiency <- lp.bulk.efficiency %>% add_column(lp.tail.efficiency[[ess_tail_efficiency]])
lp.bulk.efficiency %>% add_column(lp.tail.efficiency$ess_tail_efficiency)
lp.bulk.efficiency %>% add_column(ess_tail_efficiency=lp.tail.efficiency$ess_tail_efficiency)
lp.parallel.efficiency  <- lp.bulk.efficiency %>% add_column(ess_tail_efficiency=lp.tail.efficiency$ess_tail_efficiency)
lp.parallel.efficiency
ggplot(lp.parallel.efficiency, aes(group=as.factor(target_ESS),
  color=as.factor(target_ESS), x=parallel_chains,
  y=ess_bulk_efficiency)) +
  geom_line(aes(linetype=as.factor(target_ES))) + geom_point(aes(shape=as.factor(target_ESS)))
ggplot(lp.parallel.efficiency, aes(group=as.factor(target_ESS),
  color=as.factor(target_ESS), x=parallel_chains,
  y=ess_bulk_efficiency)) +
  geom_line(aes(linetype=as.factor(target_ESS))) + geom_point(aes(shape=as.factor(target_ESS)))
ggplot(lp.parallel.efficiency, aes(group=as.factor(target_ESS),
  color=as.factor(target_ESS), x=parallel_chains,
  y=ess_bulk_efficiency)) +
  geom_line(aes(linetype=as.factor(target_ESS))) +
  geom_point(aes(shape=as.factor(target_ESS))) +
  scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2')
ggplot(lp.parallel.efficiency, aes(group=as.factor(target_ESS),
  color=as.factor(target_ESS), x=parallel_chains,
  y=ess_bulk_efficiency)) +
  geom_line(aes(linetype=as.factor(target_ESS))) +
  geom_point(aes(shape=as.factor(target_ESS))) +
  scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
  labs(x = TeX("n_{chain}"), y = TeX("Speedup of ESS_{bulk}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
ggsave(filename="ess_bulk_per_total_time_speedup.pdf",width=6, height=4)
ggplot(lp.parallel.efficiency, aes(group=as.factor(target_ESS),
                                   color=as.factor(target_ESS), x=parallel_chains,
                                   y=ess_bulk_efficiency)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chain}(=n_{proc})"), y = TeX("Speedup of ESS_{bulk}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
ggsave(filename="ess_bulk_per_total_time_speedup.pdf",width=6, height=4)
ggplot(lp.parallel.efficiency, aes(group=as.factor(target_ESS),
                                   color=as.factor(target_ESS), x=parallel_chains,
                                   y=ess_tail_efficiency)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chain}(=n_{proc})"), y = TeX("Speedup of ESS_{tail}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
ggsave(filename="ess_tail_per_total_time_speedup.pdf",width=6, height=4)
lp.parallel.efficiency
lp.summary
lp.summary %>% filter(target_ESS==600) %>% mutate(ess_tail_efficiency=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.summary %>% filter(target_ESS==600)
lp.summary
lp.tail.speedup.600 <- lp.summary %>% filter(target_ESS==600) %>% mutate(ess_tail_efficiency=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.tail.speedup.400 <- lp.summary %>% filter(target_ESS==400) %>% mutate(ess_tail_efficiency=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.tail.speedup.200 <- lp.summary %>% filter(target_ESS==200) %>% mutate(ess_tail_efficiency=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.bulk.speedup.600 <- lp.summary %>% filter(target_ESS==600) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]))
lp.bulk.speedup.400 <- lp.summary %>% filter(target_ESS==400) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]))
lp.bulk.speedup.200 <- lp.summary %>% filter(target_ESS==200) %>% mutate(ess_bulk_efficiency=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]))
lp.tail.speedup.600 <- lp.summary %>% filter(target_ESS==600) %>% mutate(ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.tail.speedup.400 <- lp.summary %>% filter(target_ESS==400) %>% mutate(ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.tail.speedup.200 <- lp.summary %>% filter(target_ESS==200) %>% mutate(ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.bulk.speedup.600 <- lp.summary %>% filter(target_ESS==600) %>% mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]))
lp.bulk.speedup.400 <- lp.summary %>% filter(target_ESS==400) %>% mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]))
lp.bulk.speedup.200 <- lp.summary %>% filter(target_ESS==200) %>% mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]))
lp.speedup <- bind_rows(lp.bulk.speedup.200, lp.bulk.speedup.400, lp.bulk.speedup.600) %>% add_column(bind_rows(lp.tail.speedup.200, lp.tail.speedup.400,
                        lp.tail.speedup.600) [[ess_tail_speedup]])
bind_rows(lp.bulk.speedup.200, lp.bulk.speedup.400, lp.bulk.speedup.600)
ls()
rm(lp.bulk.speedup.200,lp.bulk.speedup.400, lp.bulk.speedup.600)
ls()
rm(lp.tail.speedup.200,lp.tail.speedup.400, lp.tail.speedup.600)
ls()
rm(lp.efficiency.400, lp.efficiency.200, lp.efficiency.600)
lp.speedup.600 <- lp.summary %>% filter(target_ESS==600) %>% mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]),ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.speedup.600
lp.speedup.200 <- lp.summary %>% filter(target_ESS==200) %>%
    mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]),
           ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.speedup.400 <- lp.summary %>% filter(target_ESS==400) %>%
    mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]),
           ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.speedup.600 <- lp.summary %>% filter(target_ESS==600) %>%
    mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]),
           ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.speedup <- bind_rows(lp.speedup.200, lp.speedup.400, lp.speedup.600)
lp.speedup
ggplot(lp.speedup, aes(group=as.factor(target_ESS),
                                   color=as.factor(target_ESS), x=parallel_chains,
                                   y=ess_bulk_efficiency)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chain}(=n_{proc})"), y = TeX("Speedup of ESS_{bulk}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
ggplot(lp.speedup, aes(group=as.factor(target_ESS),
                                   color=as.factor(target_ESS), x=parallel_chains,
                                   y=ess_bulk_speedup)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chain}(=n_{proc})"), y = TeX("Speedup of ESS_{bulk}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
lp.speedup
lp.speedup <- bind_rows(lp.speedup.200, lp.speedup.400, lp.speedup.600) %>% mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4),ess_tail_efficiency=ess_tail_speedup/(parallel_chains/4))
lp.speedup
ls()
rm(lp.tail.efficiency)
rm(lp.speedup.200)
rm(lp.speedup.400)
rm(lp.speedup.600)
ls()
rm(lp.bulk.efficiency)
ls()
save.image()
x <- seq(1992, 2002, by=2)
d1 <- data.frame(x=x, y=rnorm(length(x)))
xy <- expand.grid(x=x, y=x)
xy
?expand.grid
xy
d2 <- data.frame(x=xy$x, y=xy$y, z= jitter(xy$x + xy$y))
d2
d1
d1$panel <- "a"
d2$panel <- "b"
d1$z <- d1$x
d
d1
d2
d1
d <- rbind(d1, d2)
d
ggplot(data = d, mapping = aes(x = x, y = y)) + 
  facet_grid(panel~., scale="free") + 
  geom_line(data = d1, stat = "identity") + 
  geom_tile(data=d2, mapping=aes(colour=z, fill=z), stat = "identity")
lp.speedup
lp.speedup.200 <- lp.summary %>% filter(target_ESS==200) %>%
    mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]),
           ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.speedup.400 <- lp.summary %>% filter(target_ESS==400) %>%
    mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]),
           ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.speedup.600 <- lp.summary %>% filter(target_ESS==600) %>%
    mutate(ess_bulk_speedup=ess_bulk_per_total_time/(lp.summary$ess_bulk_per_total_time[1]),
           ess_tail_speedup=ess_tail_per_total_time/(lp.summary$ess_tail_per_total_time[1]))
lp.speedup <- bind_rows(lp.speedup.200, lp.speedup.400, lp.speedup.600)
lp.speedup
lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4)) %>% select(ess_bulk_speedup,ess_bulk_efficiency)
lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4)) %>%
  select(ess_bulk_speedup,ess_bulk_efficiency) %>% pivot_longer()
lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4)) %>%
  select(ess_bulk_speedup,ess_bulk_efficiency) %>% pivot_longer(c(ess_bulk_speedup,ess_bulk_efficiency))
lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4)) %>%
  select(parallel_chains, target_ESS, ess_bulk_speedup,ess_bulk_efficiency) %>% pivot_longer(c(ess_bulk_speedup,ess_bulk_efficiency))
lp.speedup.long  <- lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4)) %>%
  select(parallel_chains, target_ESS, ess_bulk_speedup,
  ess_bulk_efficiency, ess_tail_speedup, ess_tail_efficiency) %>% pivot_longer(c(ess_bulk_speedup,ess_bulk_efficiency,ess_tail_speedup,ess_tail_efficiency))
lp.speedup.long  <- lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4), ess_tail_efficiency=ess_tail_speedup/(parallel_chains/4)) %>%
  select(parallel_chains, target_ESS, ess_bulk_speedup,
  ess_bulk_efficiency, ess_tail_speedup, ess_tail_efficiency) %>% pivot_longer(c(ess_bulk_speedup,ess_bulk_efficiency,ess_tail_speedup,ess_tail_efficiency))
lp.speedup.long
lp.speedup.long %>% filter(name==ess_bulk_speedup | name==ess_bulk_efficiency)
lp.speedup.long %>% filter(name==ess_bulk_speedup | ess_bulk_efficiency)
lp.speedup.long %>% filter(name=="ess_bulk_speedup" | name="ess_bulk_efficiency")
lp.speedup.long %>% filter(name=="ess_bulk_speedup" | name=="ess_bulk_efficiency")
lp.speedup.long %>% filter(name=="ess_bulk_speedup" |
  name=="ess_bulk_efficiency") %>% ggplot(aes(x=paralle_chains,
  y=value, group=target_ESS)) + geom_line(aes(linetype=target_ESS)) + facet_grid(name~., scale="free")
lp.speedup.long %>% filter(name=="ess_bulk_speedup" |
  name=="ess_bulk_efficiency") %>% ggplot(aes(x=parallel_chains,
  y=value, group=target_ESS)) + geom_line(aes(linetype=target_ESS)) + facet_grid(name~., scale="free")
lp.speedup.long %>% filter(name=="ess_bulk_speedup" |
  name=="ess_bulk_efficiency") %>% ggplot(aes(x=parallel_chains,
  y=value, group=target_ESS)) + geom_line(aes(linetype=as.factor(target_ESS))) + facet_grid(name~., scale="free")
lp.speedup.long %>% filter(name=="ess_bulk_speedup" |
  name=="ess_bulk_efficiency") %>% ggplot(aes(x=parallel_chains,
  y=value, color=as.factor(target_ESS))) +
  geom_line(aes(linetype=as.factor(target_ESS))) +
  geom_point(aes(shape=as.factor(target_ESS))) + facet_grid(name~., scale="free")
lp.speedup.long %>% filter(name=="ess_bulk_speedup" |
  name=="ess_bulk_efficiency") %>% ggplot(aes(x=parallel_chains,
  y=value, color=as.factor(target_ESS))) +
  geom_line(aes(linetype=as.factor(target_ESS))) +
  geom_point(aes(shape=as.factor(target_ESS))) + facet_grid(name~.,
  scale="free") +     scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2')
lp.speedup.long$name
lp.speedup.long$name[lp.speedup.long$name=="ess_bulk_efficiency"] = TeX("Parallel efficiency of ESS_{bulk}")
lp.speedup.long$name[lp.speedup.long$name=="ess_bulk_efficiency"]
lp.speedup.long$name[lp.speedup.long$name=="ess_bulk_efficiency"] = "fdaklfj"
levels(lp.speedup.long$name)
lp.speedup.long  <- lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4), ess_tail_efficiency=ess_tail_speedup/(parallel_chains/4)) %>%
  select(parallel_chains, target_ESS, ess_bulk_speedup,
  ess_bulk_efficiency, ess_tail_speedup, ess_tail_efficiency) %>% pivot_longer(c(ess_bulk_speedup,ess_bulk_efficiency,ess_tail_speedup,ess_tail_efficiency))

lp.speedup.long$name[lp.speedup.long$name=="ess_bulk_efficiency"] = TeX("Parallel efficiency of ESS_{bulk}")
lp.speedup.long
levels(lp.speedup.long$name) <- c(ess_bulk_efficiency=TeX("$Parallel efficiency of ESS_{bulk}$"),
ess_bulk_speed=TeX("$Speedup of ESS_{bulk}$"),ess_tail_efficiency=TeX("$Parallel efficiency of ESS_{tail}$"),
+ ess_tail_speed=TeX("$Speedup of ESS_{tail}$"))
levels(lp.speedup.long$name) <- c(ess_bulk_efficiency=TeX("$Parallel efficiency of ESS_{bulk}$"),ess_bulk_speed=TeX("$Speedup of ESS_{bulk}$"))
levels(lp.speedup.long$name) <- c(ess_bulk_efficiency=TeX("$Parallel efficiency of ESS_{bulk}$"),ess_bulk_speed=TeX("$Speedup of ESS_{bulk}$"),ess_tail_efficiency=TeX("$Parallel efficiency of ESS_{tail}$"),ess_tail_speed=TeX("$Speedup of ESS_{tail}$"))
levels(lp.speedup.long$name) <- c("a","b","c","d")
levels(lp.speedup.long$name)
lp.speedup.long  <- lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4), ess_tail_efficiency=ess_tail_speedup/(parallel_chains/4)) %>%
  select(parallel_chains, target_ESS, ess_bulk_speedup,
  ess_bulk_efficiency, ess_tail_speedup, ess_tail_efficiency) %>% pivot_longer(c(ess_bulk_speedup,ess_bulk_efficiency,ess_tail_speedup,ess_tail_efficiency))

lp.speedup.long$name[lp.speedup.long$name == "ess_bulk_speedup"]=bquote('Speedup of ESS_bulk')
lp.speedup.long$name
?bquote
lp.speedup.long  <- lp.speedup %>%
  mutate(ess_bulk_efficiency=ess_bulk_speedup/(parallel_chains/4), ess_tail_efficiency=ess_tail_speedup/(parallel_chains/4)) %>%
  select(parallel_chains, target_ESS, ess_bulk_speedup,
  ess_bulk_efficiency, ess_tail_speedup, ess_tail_efficiency) %>% pivot_longer(c(ess_bulk_speedup,ess_bulk_efficiency,ess_tail_speedup,ess_tail_efficiency))
lp.speedup.long %>% filter(name=="ess_bulk_speedup" |
                           name=="ess_bulk_efficiency") %>% ggplot(aes(x=parallel_chains,
                                                                       y=value, color=as.factor(target_ESS))) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    facet_grid(name~., scale="free", labeller = label_parsed) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2')

ggplot(lp.speedup, aes(group=as.factor(target_ESS),
                                   color=as.factor(target_ESS), x=parallel_chains,
                                   y=ess_bulk_speedup)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chain}(=n_{proc})"), y = TeX("Speedup of ESS_{bulk}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
ggsave(filename="ess_bulk_per_total_time_speedup.pdf",width=6, height=4)

ggplot(lp.parallel.efficiency, aes(group=as.factor(target_ESS),
                                   color=as.factor(target_ESS), x=parallel_chains,
                                   y=ess_tail_efficiency)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chain}(=n_{proc})"), y = TeX("Speedup of ESS_{tail}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
ggsave(filename="ess_tail_per_total_time_speedup.pdf",width=6, height=4)

ggplot(lp.speedup, aes(group=as.factor(target_ESS),
                                   color=as.factor(target_ESS), x=parallel_chains,
                                   y=ess_tail_speedup)) +
    geom_line(aes(linetype=as.factor(target_ESS))) +
    geom_point(aes(shape=as.factor(target_ESS))) +
    scale_x_continuous(trans='log2') + scale_y_continuous(trans='log2') +
    labs(x = TeX("n_{chain}(=n_{proc})"), y = TeX("Speedup of ESS_{tail}/(Time_{total})"),  color="Target ESS", shape="Target ESS",linetype="Target ESS")
ggsave(filename="ess_tail_per_total_time_speedup.pdf",width=6, height=4)
save.image()
q()

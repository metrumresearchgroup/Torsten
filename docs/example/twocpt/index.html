<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Two-compartment model for single patient - Torsten</title>
<meta name="description" content="A pharmacokinetics/pharmacodynamics library for Stan">
<meta name="generator" content="Hugo 0.83.1" />
<link href="https://metrumresearchgroup.github.io/Torsten//index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://metrumresearchgroup.github.io/Torsten/example/twocpt/">
<link rel="stylesheet" href="https://metrumresearchgroup.github.io/Torsten/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://metrumresearchgroup.github.io/Torsten/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script src="https://metrumresearchgroup.github.io/Torsten/js/bundle.js"></script><style>
:root {--custom-background-color: #005933;}
</style>
<meta property="og:title" content="Two-compartment model for single patient" />
<meta property="og:description" content="We model drug absorption in a single patient and simulate plasma drug concentrations:
 Multiple Doses: 1250 mg, every 12 hours, for a total of 15 doses PK measured at 0.083, 0.167, 0.25, 0.5, 0.75, 1, 1.5, 2, 4, 6, 8, 10 and 12 hours after 1st, 2nd, and 15th dose. In addition, the PK is measured every 12 hours throughout the trial.  With the plasma concentration \(\hat{c}\) using Two Compartment Model, we simulate \(c\) according to:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://metrumresearchgroup.github.io/Torsten/example/twocpt/" /><meta property="og:image" content="https://metrumresearchgroup.github.io/Torsten/images/logo.png"/><meta property="article:section" content="example" />
<meta property="article:published_time" content="2021-06-25T00:00:00-07:00" />
<meta property="article:modified_time" content="2021-06-29T14:35:31-07:00" /><meta property="og:site_name" content="Hugo Techdoc Theme" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://metrumresearchgroup.github.io/Torsten/images/logo.png"/>

<meta name="twitter:title" content="Two-compartment model for single patient"/>
<meta name="twitter:description" content="We model drug absorption in a single patient and simulate plasma drug concentrations:
 Multiple Doses: 1250 mg, every 12 hours, for a total of 15 doses PK measured at 0.083, 0.167, 0.25, 0.5, 0.75, 1, 1.5, 2, 4, 6, 8, 10 and 12 hours after 1st, 2nd, and 15th dose. In addition, the PK is measured every 12 hours throughout the trial.  With the plasma concentration \(\hat{c}\) using Two Compartment Model, we simulate \(c\) according to:"/>
<meta itemprop="name" content="Two-compartment model for single patient">
<meta itemprop="description" content="We model drug absorption in a single patient and simulate plasma drug concentrations:
 Multiple Doses: 1250 mg, every 12 hours, for a total of 15 doses PK measured at 0.083, 0.167, 0.25, 0.5, 0.75, 1, 1.5, 2, 4, 6, 8, 10 and 12 hours after 1st, 2nd, and 15th dose. In addition, the PK is measured every 12 hours throughout the trial.  With the plasma concentration \(\hat{c}\) using Two Compartment Model, we simulate \(c\) according to:"><meta itemprop="datePublished" content="2021-06-25T00:00:00-07:00" />
<meta itemprop="dateModified" content="2021-06-29T14:35:31-07:00" />
<meta itemprop="wordCount" content="687"><meta itemprop="image" content="https://metrumresearchgroup.github.io/Torsten/images/logo.png"/>
<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>Torsten</h1><span class="version">Version 0.89.0</span><a href="https://github.com/metrumresearchgroup/Torsten" class="github"><i class="fab fa-github"></i></a>
<p class="description">A pharmacokinetics/pharmacodynamics library for Stan</p>

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/Torsten/">Home</a></li>
<li><a href="/Torsten/dev-team/">Development team</a></li>
<li><a href="/Torsten/acknowledgements/">Acknowledgements</a></li>
<li><a href="/Torsten/changelog/">Changelog</a></li>
<li><a href="/Torsten/installation/">Installation</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Two-compartment model for single patient</h1>
<p>We model drug absorption in a single patient and simulate plasma drug concentrations:</p>
<ul>
<li>Multiple Doses: 1250 mg, every 12 hours, for a total of 15 doses</li>
<li>PK measured at 0.083, 0.167, 0.25, 0.5, 0.75, 1, 1.5, 2, 4, 6,
8, 10 and 12 hours after 1st, 2nd, and 15th dose. In addition, the
PK is measured every 12 hours throughout the trial.</li>
</ul>
<p>With the plasma concentration \(\hat{c}\) using
<a href="/Torsten/function/two-cpt/">Two Compartment Model</a>, we simulate \(c\) according to:</p>
<p>\begin{align*}
\log\left(c\right) &amp;\sim N\left(\log\left(\widehat{c}\right),\sigma^2\right) \\\<br>
\left(CL, Q, V_2, V_3, ka\right) &amp;= \left(5\ {\rm L/h}, 8\  {\rm L/h}, 20\  {\rm L},  70\ {\rm L}, 1.2\ {\rm h^{-1}} \right) \\\<br>
\sigma^2 &amp;= 0.01
\end{align*}</p>
<p>The data are generated using the R package <code>mrgsolve</code> (<a href="#org3d2af14">Baron and Gastonguay 2015</a>).</p>
<p>Code below shows how Torsten function <code>pmx_solve_twocpt</code> can be used to fit the above model.</p>
<pre><code class="language-stan" data-lang="stan">data{
  int&lt;lower = 1&gt; nt;  // number of events
  int&lt;lower = 1&gt; nObs;  // number of observation
  int&lt;lower = 1&gt; iObs[nObs];  // index of observation

  // NONMEM data
  int&lt;lower = 1&gt; cmt[nt];
  int evid[nt];
  int addl[nt];
  int ss[nt];
  real amt[nt];
  real time[nt];
  real rate[nt];
  real ii[nt];

  vector&lt;lower = 0&gt;[nObs] cObs;  // observed concentration (Dependent Variable)
}

transformed data{
  vector[nObs] logCObs = log(cObs);
  int nTheta = 5;  // number of ODE parameters in Two Compartment Model
  int nCmt = 3;  // number of compartments in model
}

parameters{
  real&lt;lower = 0&gt; CL;
  real&lt;lower = 0&gt; Q;
  real&lt;lower = 0&gt; V1;
  real&lt;lower = 0&gt; V2;
  real&lt;lower = 0&gt; ka;
  real&lt;lower = 0&gt; sigma;
}

transformed parameters{
  real theta[nTheta];  // ODE parameters
  row_vector&lt;lower = 0&gt;[nt] cHat;
  vector&lt;lower = 0&gt;[nObs] cHatObs;
  matrix&lt;lower = 0&gt;[nCmt, nt] x;

  theta[1] = CL;
  theta[2] = Q;
  theta[3] = V1;
  theta[4] = V2;
  theta[5] = ka;

  x = pmx_solve_twocpt(time, amt, rate, ii, evid, cmt, addl, ss, theta);

  cHat = x[2, :] ./ V1; // we're interested in the amount in the second compartment

  cHatObs = cHat'[iObs]; // predictions for observed data recors
}

model{
  // informative prior
  CL ~ lognormal(log(10), 0.25);
  Q ~ lognormal(log(15), 0.5);
  V1 ~ lognormal(log(35), 0.25);
  V2 ~ lognormal(log(105), 0.5);
  ka ~ lognormal(log(2.5), 1);
  sigma ~ cauchy(0, 1);

  logCObs ~ normal(log(cHatObs), sigma);
}
</code></pre><p>Four MCMC chains of 2000 iterations (1000 warmup iterations and 1000
sampling iterations) are simulated. 1000 samples per chain were used for the subsequent analyses.
The MCMC history plots(Figure <a href="#orgd835e1e">1</a>)
suggest that the 4 chains have converged to common distributions for
all of the key model parameters. The fit to the plasma concentration
data (Figure <a href="#org99a0cd0">3</a>) are in close agreement with the
data, which is not surprising since the fitted model is identical to
the one used to simulate the data. Similarly the parameter posterior
density can be examined in Figure <a href="#orgcd32ad6">2</a> and shows
consistency with the values used for simulation. Another way to
summarize the posterior is through <code>cmdstanr</code>&rsquo;s <code>summary</code> method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">## fit is a CmdStanMCMC object returned by sampling. See cmdstanr reference.</span>
<span style="color:#f92672">&gt;</span> pars <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;CL&#34;</span>, <span style="color:#e6db74">&#34;Q&#34;</span>, <span style="color:#e6db74">&#34;V1&#34;</span>, <span style="color:#e6db74">&#34;V2&#34;</span>, <span style="color:#e6db74">&#34;ka&#34;</span>, <span style="color:#e6db74">&#34;sigma&#34;</span>)
<span style="color:#f92672">&gt;</span> fit<span style="color:#f92672">$</span><span style="color:#a6e22e">summary</span>(pars)
<span style="color:#75715e"># A tibble: 6 x 10</span>
  variable   mean median     sd    mad      q5    q95  rhat ess_bulk ess_tail
  <span style="color:#f92672">&lt;</span>chr<span style="color:#f92672">&gt;</span>     <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>  <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>  <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>  <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>   <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>  <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>    <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>    <span style="color:#f92672">&lt;</span>dbl<span style="color:#f92672">&gt;</span>
<span style="color:#ae81ff">1</span> CL        <span style="color:#ae81ff">4.82</span>   <span style="color:#ae81ff">4.83</span>  <span style="color:#ae81ff">0.0910</span> <span style="color:#ae81ff">0.0870</span>  <span style="color:#ae81ff">4.68</span>    <span style="color:#ae81ff">4.97</span>   <span style="color:#ae81ff">1.00</span>    <span style="color:#ae81ff">1439</span>.    <span style="color:#ae81ff">1067</span>.
2 Q         <span style="color:#ae81ff">7.56</span>   <span style="color:#ae81ff">7.55</span>  <span style="color:#ae81ff">0.588</span>  <span style="color:#ae81ff">0.586</span>   <span style="color:#ae81ff">6.61</span>    <span style="color:#ae81ff">8.56</span>   <span style="color:#ae81ff">1.00</span>    <span style="color:#ae81ff">1256</span>.    <span style="color:#ae81ff">1235</span>.
3 V1       <span style="color:#ae81ff">21.1</span>   <span style="color:#ae81ff">21.1</span>   <span style="color:#ae81ff">2.50</span>   <span style="color:#ae81ff">2.45</span>   <span style="color:#ae81ff">17.1</span>    <span style="color:#ae81ff">25.3</span>    <span style="color:#ae81ff">1.00</span>    <span style="color:#ae81ff">1057</span>.    <span style="color:#ae81ff">1177</span>.
4 V2       <span style="color:#ae81ff">76.1</span>   <span style="color:#ae81ff">76.1</span>   <span style="color:#ae81ff">5.33</span>   <span style="color:#ae81ff">4.93</span>   <span style="color:#ae81ff">67.5</span>    <span style="color:#ae81ff">84.9</span>    <span style="color:#ae81ff">1.01</span>    <span style="color:#ae81ff">1585</span>.    <span style="color:#ae81ff">1372</span>.
5 ka        <span style="color:#ae81ff">1.23</span>   <span style="color:#ae81ff">1.23</span>  <span style="color:#ae81ff">0.175</span>  <span style="color:#ae81ff">0.174</span>   <span style="color:#ae81ff">0.958</span>   <span style="color:#ae81ff">1.52</span>   <span style="color:#ae81ff">1.00</span>    <span style="color:#ae81ff">1070</span>.    <span style="color:#ae81ff">1122</span>.
6 sigma     <span style="color:#ae81ff">0.109</span>  <span style="color:#ae81ff">0.108</span> <span style="color:#ae81ff">0.0117</span> <span style="color:#ae81ff">0.0111</span>  <span style="color:#ae81ff">0.0911</span>  <span style="color:#ae81ff">0.130</span>  <span style="color:#ae81ff">1.01</span>    <span style="color:#ae81ff">1414</span>.     <span style="color:#ae81ff">905</span>.
</code></pre></div><p><a id="orgd835e1e"></a></p>
<figure><img src="https://raw.githubusercontent.com/metrumresearchgroup/Torsten/3c631dfd81f008a275a7b5b74c8c7bb80f6deacb/example-models/pk2cpt/deliv/figure/history.png"
         alt="Figure 1: MCMC history plots for the parameters of a two compartment model with first order absorption (each color corresponds to a different chain)" width="700"/><figcaption>
            <p>Figure 1: MCMC history plots for the parameters of a two compartment model with first order absorption (each color corresponds to a different chain)</p>
        </figcaption>
</figure>

<p><a id="orgcd32ad6"></a></p>
<figure><img src="https://raw.githubusercontent.com/metrumresearchgroup/Torsten/3c631dfd81f008a275a7b5b74c8c7bb80f6deacb/example-models/pk2cpt/deliv/figure/density.png"
         alt="Figure 2: Posterior marginal densities of the Model Parameters of a two compartment model with first order absorption (each color corresponds to a different chain)"/><figcaption>
            <p>Figure 2: Posterior marginal densities of the Model Parameters of a two compartment model with first order absorption (each color corresponds to a different chain)</p>
        </figcaption>
</figure>

<p><a id="org99a0cd0"></a></p>
<figure><img src="https://raw.githubusercontent.com/metrumresearchgroup/Torsten/3c631dfd81f008a275a7b5b74c8c7bb80f6deacb/example-models/pk2cpt/deliv/figure/ppc_ribbon.png"
         alt="Figure 3: Predicted (\(y_{\text{rep}}\)) and observed (\(y\)) plasma drug concentrations of a two compartment model with first order absorption. \(y_{\text{rep}}\) is shown with posterior median, 50%, 90% credible intervals."/><figcaption>
            <p>Figure 3: Predicted (\(y_{\text{rep}}\)) and observed (\(y\)) plasma drug concentrations of a two compartment model with first order absorption. \(y_{\text{rep}}\) is shown with posterior median, 50%, 90% credible intervals.</p>
        </figcaption>
</figure>

<h2 id="bibliography">Bibliography</h2>
<p><a id="org3d2af14"></a>Baron, Kyle T., and Marc R. Gastonguay. 2015. “Simulation from ODE-Based Population PK/PD and Systems Pharmacology Models in R with Mrgsolve.” <em>Journal of Pharmacokinetics and Pharmacodynamics</em> 42 (W-23):S84–85.</p>
<div class="edit-meta">
Last updated on 29 Jun 2021


<br>
Published on 25 Jun 2021
<br><a href="https://github.com/thingsym/hugo-theme-techdoc/edit/master/content/example/twocpt.md" class="edit-page"><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="https://metrumresearchgroup.github.io/Torsten/example/" title="Examples"><i class="fas fa-arrow-left" aria-hidden="true"></i>&nbsp;Prev - Examples</a>
<a class="nav nav-next" href="https://metrumresearchgroup.github.io/Torsten/example/twocpt-lin/" title="Two-compartment model as a linear ODE model for single patient">Next - Two-compartment model as a linear ODE model for single patient <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Exported
  from <a href="https://www.gnu.org/software/emacs/">Emacs 27.1</a>
  + <a href="https://orgmode.org/Changes.html">Org mode 9.4</a>
  + <a href="https://ox-hugo.scripter.co/">ox-hugo</a>. Powered
  by <a href="https://gohugo.io">Hugo</a>. Theme
  by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed
  by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>


</footer>
</main>
<div class="sidebar">

<nav class="open-menu">
<ul>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/">Home</a></li>

<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/">Using Torsten</a>
  
<ul class="sub-menu">
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/events/">Events specification</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/one-cpt/">One Compartment Model</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/two-cpt/">Two Compartment Model</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/linode/">General Linear ODE Model Function</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/genode/">General ODE Model Function</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/coupled/">Coupled ODE Model Function</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/ode-pop/">General ODE-based Population Model Function</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/ode-integ/">ODE  integrator function</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/ode-group-integ/">ODE group  integrator Function</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/1d_integ/1d_integ/">Univariate integral</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/function/pc_lin_interp/pc_lin_interp/">Piecewise linear interpolation</a></li>
</ul>
  
</li>

<li class="parent"><a href="https://metrumresearchgroup.github.io/Torsten/example/">Examples</a>
  
<ul class="sub-menu">
<li class="active"><a href="https://metrumresearchgroup.github.io/Torsten/example/twocpt/">Two-compartment model for single patient</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/twocpt-lin/">Two-compartment model as a linear ODE model for single patient</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/twocpt-ode/">Two-compartment model solved by numerical integrator for single patient</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/pkpd/">Joint PK-PD model</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/twocp-pop/">Two-compartment population model</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/ode-group/">Lotka-Volterra group model</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/1d-intg/">Univariate integral of a quadratic function</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/lin-interp/">Linear intepolation</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/effcpt/">Effect Compartment Population Model</a></li>
<li class=""><a href="https://metrumresearchgroup.github.io/Torsten/example/pkpd-pop/">Friberg-Karlsson Semi-Mechanistic Population Model</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>

</div>
<a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>


<script src="https://metrumresearchgroup.github.io/Torsten/js/mathjax-config.js"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</div>
</body>
</html>
